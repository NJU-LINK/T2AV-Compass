#!/bin/bash
################################################################################
# 执行所有模型评测并生成 README 报告
################################################################################

set -e

cd /root/bayes-tmp/eval/text_similarity/ImageBind-main

echo "================================================================================"
echo "开始执行模型评测并生成报告"
echo "================================================================================"
echo ""

# 激活 conda 环境
echo "激活 conda 环境: imagebind"
source $(conda info --base)/etc/profile.d/conda.sh
conda activate imagebind
echo "当前环境: $CONDA_DEFAULT_ENV"
echo ""

# 创建日志目录
LOG_DIR="./test_logs_$(date +%Y%m%d_%H%M%S)"
mkdir -p "$LOG_DIR"

OVERALL_START=$(date +%s)

# 执行三个测试
echo "================================================================================"
echo "开始测试: MTV"
echo "================================================================================"
bash test_mtv.sh 2>&1 | tee "${LOG_DIR}/mtv.log"
echo ""

echo "================================================================================"
echo "开始测试: SORA2"
echo "================================================================================"
bash test_sora2.sh 2>&1 | tee "${LOG_DIR}/sora2.log"
echo ""

echo "================================================================================"
echo "开始测试: VEO3"
echo "================================================================================"
bash test_veo3.sh 2>&1 | tee "${LOG_DIR}/veo3.log"
echo ""

OVERALL_END=$(date +%s)
OVERALL_DURATION=$((OVERALL_END - OVERALL_START))

echo "================================================================================"
echo "所有测试完成，生成 README 报告..."
echo "================================================================================"
echo ""

# 生成 README
python3 generate_results_readme.py

echo ""
echo "================================================================================"
echo "完成！"
echo "================================================================================"
echo ""
echo "总耗时: $((OVERALL_DURATION / 60)) 分钟 $((OVERALL_DURATION % 60)) 秒"
echo "日志目录: $LOG_DIR"
echo "结果目录: ./batch_test_results/"
echo "README 报告: ./batch_test_results/README.md"
echo ""

